<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gold Water â€¢ ET Bottled Water</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root {
      --bg: #ffffff;
      --text: #000000;
      --hint: #999999;
      --button: #0088cc;
      --button-text: #ffffff;
      --secondary: #f0f0f0;
      --accent: #2e7d32;
      --danger: #d32f2f;
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 16px;
      padding-bottom: 90px;
    }

    h1 { font-size: 26px; text-align: center; margin: 0 0 24px; }

    .product {
      background: var(--secondary);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 24px;
      position: relative;
      overflow: hidden;
      transition: transform 0.15s;
      cursor: pointer;
    }

    .product:active { transform: scale(0.98); }

    .product img {
      width: 100%;
      height: auto;
      border-radius: 12px;
      margin-bottom: 12px;
      object-fit: cover;
    }

    .product h2 { font-size: 22px; margin-bottom: 8px; }
    .product .desc { color: var(--hint); font-size: 15px; margin-bottom: 12px; line-height: 1.4; }
    .product .price-info { font-size: 16px; color: var(--accent); margin-bottom: 12px; }

    .added-flash {
      position: absolute;
      inset: 0;
      background: rgba(46,125,50,0.18);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      font-weight: bold;
      color: var(--accent);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.6s;
      z-index: 2;
    }

    .added-flash.show { opacity: 1; }

    select {
      width: 100%;
      padding: 10px;
      margin: 12px 0;
      border-radius: 8px;
      border: 1px solid var(--hint);
      font-size: 16px;
      background: var(--bg);
      color: var(--text);
    }

    .qty-controls {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-top: 12px;
      justify-content: center;
    }

    .qty-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--button);
      color: white;
      font-size: 24px;
      line-height: 44px;
      text-align: center;
      cursor: pointer;
      user-select: none;
    }

    .qty-btn:active { background: #006699; }

    #cart-summary {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      background: var(--bg);
      border-top: 1px solid var(--secondary);
      padding: 16px;
      box-shadow: 0 -4px 16px rgba(0,0,0,0.1);
      transform: translateY(100%);
      transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    #cart-summary.visible { transform: translateY(0); }

    .cart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .cart-header h2 { font-size: 18px; }

    #cart-items { list-style: none; margin-bottom: 12px; }
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--secondary);
      font-size: 16px;
    }

    .cart-item-name { flex: 1; font-weight: 500; }
    .cart-item-price { font-weight: bold; color: var(--accent); min-width: 100px; text-align: right; }

    .remove-btn {
      color: var(--danger);
      font-size: 22px;
      width: 36px;
      height: 36px;
      line-height: 36px;
      text-align: center;
      cursor: pointer;
    }

    #total {
      font-size: 20px;
      font-weight: 700;
      text-align: right;
      margin: 12px 0;
    }

    #empty { text-align: center; color: var(--hint); padding: 40px 0; font-size: 16px; }

    #modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.65);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    #modal.show { display: flex; }

    .modal-content {
      background: var(--bg);
      border-radius: 20px;
      padding: 24px;
      margin: 20px;
      max-width: 90%;
      position: relative;
    }

    .close-modal {
      position: absolute;
      top: 12px;
      right: 16px;
      font-size: 28px;
      cursor: pointer;
      color: var(--hint);
    }

    .modal-img {
      width: 100%;
      border-radius: 16px;
      margin-bottom: 16px;
    }

    .modal-desc {
      font-size: 16px;
      line-height: 1.5;
      margin-bottom: 16px;
    }

    @media (min-width: 500px) {
      body { max-width: 480px; margin: 0 auto; }
    }
  </style>
</head>
<body>

  <h1>Gold Water</h1>

  <div class="product" id="product-card">
    <img src="https://i.postimg.cc/xTXcXRGR/gold-water-image.webp" alt="Gold Water">
    <h2>Gold Water</h2>
    <div class="desc">Premium gold-infused spring water â€“ luxurious hydration with a refreshing and crisp taste.</div>
    <div class="price-info">Choose your size below</div>
    <div class="qty-controls">
      <div class="qty-btn" onclick="addToCart()">+</div>
    </div>
    <div class="added-flash" id="flash">Added!</div>
  </div>

  <div id="cart-summary">
    <div class="cart-header">
      <h2>Your Cart</h2>
      <span id="cart-count">0</span>
    </div>

    <ul id="cart-items"></ul>

    <div id="total">Total: 0 Birr</div>

    <div id="empty">Your cart is empty â€“ add Gold Water! ðŸ’§</div>
  </div>

  <!-- Details Modal with Size Selection -->
  <div id="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal()">Ã—</span>
      <h2>Gold Water</h2>
      <img class="modal-img" src="https://i.postimg.cc/xTXcXRGR/gold-water-image.webp" alt="Gold Water">
      <p class="modal-desc">
        Premium gold-infused spring water â€“ luxurious hydration with a refreshing and crisp taste.<br><br>
        Select your preferred bottle size and add to cart.
      </p>

      <label for="size-select">Choose Size:</label>
      <select id="size-select">
        <option value="0">0.3L â€“ 140 Birr</option>
        <option value="1" selected>0.6L â€“ 150 Birr</option>
        <option value="2">2L â€“ 160 Birr</option>
      </select>

      <div class="qty-controls" style="justify-content: center; margin-top: 20px;">
        <div class="qty-btn" onclick="addToCartFromModal()">Add to Cart</div>
      </div>
    </div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    tg.MainButton.setParams({
      text: 'Checkout',
      color: '#0088cc',
      text_color: '#ffffff'
    });
    tg.MainButton.hide();

    // Theme sync
    function applyTheme() {
      const th = tg.themeParams;
      document.documentElement.style.setProperty('--bg', th.bg_color || '#ffffff');
      document.documentElement.style.setProperty('--text', th.text_color || '#000');
      document.documentElement.style.setProperty('--hint', th.hint_color || '#999');
      document.documentElement.style.setProperty('--button', th.button_color || '#0088cc');
      document.documentElement.style.setProperty('--button-text', th.button_text_color || '#fff');
      document.documentElement.style.setProperty('--secondary', th.secondary_bg_color || '#f0f0f0');
    }
    applyTheme();
    tg.onEvent('themeChanged', applyTheme);

    // Single product with 3 variants (sizes & prices in Birr)
    const product = {
      name: "Gold Water",
      image: "https://i.postimg.cc/xTXcXRGR/gold-water-image.webp",
      desc: "Premium gold-infused spring water â€“ luxurious hydration with a refreshing and crisp taste.",
      variants: [
        { size: "0.3L", price: 140 },
        { size: "0.6L", price: 150 },
        { size: "2L",   price: 160 }
      ]
    };

    let cart = []; // Array of {variantIndex, qty}

    // Cart persistence
    function loadCart() {
      tg.CloudStorage.getItem('gold_cart', (err, val) => {
        if (!err && val) {
          cart = JSON.parse(val);
          renderCart();
          updateMainButton();
        }
      });
    }

    function saveCart() {
      tg.CloudStorage.setItem('gold_cart', JSON.stringify(cart));
    }

    // Add selected variant
    function addToCart(variantIndex = 1) {  // default to 0.6L
      const existing = cart.find(item => item.variantIndex === variantIndex);
      if (existing) {
        existing.qty++;
      } else {
        cart.push({ variantIndex, qty: 1 });
      }

      saveCart();
      tg.HapticFeedback.impactOccurred('medium');
      renderCart();
      updateMainButton();

      const flash = document.getElementById('flash');
      flash.classList.add('show');
      setTimeout(() => flash.classList.remove('show'), 900);
    }

    function changeQty(variantIndex, delta) {
      const item = cart.find(i => i.variantIndex === variantIndex);
      if (!item) return;
      item.qty = Math.max(0, item.qty + delta);
      if (item.qty === 0) {
        cart = cart.filter(i => i.variantIndex !== variantIndex);
      }
      saveCart();
      renderCart();
      tg.HapticFeedback.impactOccurred('light');
    }

    function renderCart() {
      const list = document.getElementById('cart-items');
      const totalEl = document.getElementById('total');
      const countEl = document.getElementById('cart-count');
      const emptyEl = document.getElementById('empty');
      const summary = document.getElementById('cart-summary');

      list.innerHTML = '';
      let total = 0;
      let itemCount = 0;

      if (cart.length === 0) {
        emptyEl.style.display = 'block';
        countEl.textContent = '0';
        totalEl.textContent = 'Total: 0 Birr';
        summary.classList.remove('visible');
        tg.MainButton.hide();
        return;
      }

      emptyEl.style.display = 'none';
      summary.classList.add('visible');

      cart.forEach(cartItem => {
        const variant = product.variants[cartItem.variantIndex];
        const lineTotal = variant.price * cartItem.qty;
        total += lineTotal;
        itemCount += cartItem.qty;

        const li = document.createElement('li');
        li.className = 'cart-item';
        li.innerHTML = `
          <span class="cart-item-name">${product.name} ${variant.size}</span>
          <div class="qty-controls" style="margin:0; width:auto;">
            <div class="qty-btn" onclick="changeQty(${cartItem.variantIndex}, -1)">âˆ’</div>
            <span style="min-width:30px; text-align:center; font-size:16px;">${cartItem.qty}</span>
            <div class="qty-btn" onclick="changeQty(${cartItem.variantIndex}, 1)">+</div>
          </div>
          <span class="cart-item-price">${lineTotal} Birr</span>
          <span class="remove-btn" onclick="changeQty(${cartItem.variantIndex}, -999)">Ã—</span>
        `;
        list.appendChild(li);
      });

      countEl.textContent = itemCount;
      totalEl.textContent = `Total: ${total} Birr`;

      updateMainButton();
    }

    function updateMainButton() {
      if (cart.length === 0) {
        tg.MainButton.hide();
        return;
      }

      const total = cart.reduce((sum, item) => {
        return sum + product.variants[item.variantIndex].price * item.qty;
      }, 0);

      tg.MainButton.setText(`Checkout â€¢ ${total} Birr`);
      tg.MainButton.show();
    }

    // Modal show
    function showDetails() {
      document.getElementById('modal').classList.add('show');
      tg.HapticFeedback.impactOccurred('light');
    }

    function closeModal() {
      document.getElementById('modal').classList.remove('show');
    }

    window.addToCartFromModal = () => {
      const select = document.getElementById('size-select');
      const variantIndex = parseInt(select.value);
      addToCart(variantIndex);
      closeModal();
    };

    // Checkout simulation
    tg.MainButton.onClick(() => {
      if (cart.length === 0) return;

      tg.HapticFeedback.impactOccurred('heavy');

      let summaryText = "Order summary:\n";
      cart.forEach(item => {
        const v = product.variants[item.variantIndex];
        summaryText += `${product.name} ${v.size} Ã— ${item.qty} = ${v.price * item.qty} Birr\n`;
      });
      const grandTotal = cart.reduce((s, i) => s + product.variants[i.variantIndex].price * i.qty, 0);
      summaryText += `\nTotal: ${grandTotal} Birr\n\n(Real version would process payment here â€“ e.g. via local gateway or Telegram Stars)`; 

      alert(summaryText);

      setTimeout(() => {
        alert("Payment simulation: SUCCESS! Thank you for choosing Gold Water! ðŸ’§âœ¨");
        cart = [];
        saveCart();
        renderCart();
        tg.MainButton.hide();
      }, 900);
    });

    // Start
    document.getElementById('product-card').addEventListener('click', showDetails);
    loadCart();
    renderCart();
  </script>

</body>
</html>